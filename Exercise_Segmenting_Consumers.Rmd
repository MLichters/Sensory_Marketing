---
title: "Sensory Marketing"
subtitle: 'Solutions - Exercise: Segmenting consumers based on sensory acceptance tests in sensory labs, immersive environments, and natural consumption settings'
author: "Univ.-Prof. Dr. Marcel Lichters"
date: "`r Sys.Date()`"
output:
  html_document: 
    df_print: default
    editor_options:
      chunk_output_type: console
      markdown: 
    keep_md: yes
    number_sections: yes
    toc: yes
    toc_collapsed: yes
    toc_float: yes
  chunk_output_type: console
theme: lumen
bibliography: Citavi_Export2.bib
csl: apa.csl
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE, warning=FALSE, message=FALSE, include = TRUE)


```

------------------------------------------------------------------------

<a title="Follow me on ResearchGate" href="https://www.researchgate.net/profile/Marcel_Lichters?cp=shp"><img src="https://www.researchgate.net/images/public/profile_share_badge.png" alt="Follow me on ResearchGate"/></a>

[Connect with me on Open Science Framework](https://osf.io/u7hyz/) \| [Contact me via LinkedIn](https://www.linkedin.com/in/lichters/)

*Depending on your machine it might be necessary to use right-click -\> open in new browser window.*

------------------------------------------------------------------------

R analysis script presenting the solutions for the exercise in Sensory Marketing regarding Lichters et al.[-@Lichters.2021c] . 

> If this exercise grabs your attention, please check-out our study programs at the Chemnitz University of Technology by clicking on the logo (Germany): <a title="Chemnitz University of Technology" href="https://www.tu-chemnitz.de/wirtschaft/fakultaet/studiengaenge.php.en"><img src="TU_Chemnitz_Logo.png" alt="Chemnitz University of Technology"/></a>

# Loading packages that we will use

> Beware: *R* is a context-sensitive language. Thus, 'data' will be interpreted not in the same way as 'Data' will.

In *R* most functionality is provided by additional packages.\
Most of the packages are well-documented, See: <https://cran.r-project.org/>

The code chunk below first evaluates if the package [pacman](https://cran.r-project.org/web/packages/pacman/index.html) is already installed to your machine. If yes, the corresponding package will be loaded. If not, *R* will install the package.

Alternatively, you can do this manually first by executing *install.packages("pacman")* and then *library(pacman)*.

The second line then loads the package *pacman*

The third line uses the function *p_load()* from the pacman package to install (if necessary) and load all packages that we provide as arguments (e.g., [osfr](https://cran.r-project.org/web/packages/osfr/index.html), which provides functions for interfacing with the open science framework from *R*).

```{r , warning=FALSE, message=FALSE, hide=TRUE}


if(!"pacman" %in% rownames(installed.packages())) install.packages("pacman")

library(pacman)

pacman::p_load(tidyverse, dplyr, tidyselect, osfr, rstatix)

```


------------------------------------------------------------------------

Here is the *R* session info which gives you information on my machine, all loaded packages and their version:

```{r  }

sessionInfo()


```

------------------------------------------------------------------------

# Task 5.1. Loading data from OSF

The article provides us with the link to a corresponding OSF project: <https://doi.org/10.17605/OSF.IO/VKZ4Y>. Here, we can find all data sets and *R*-scrips accompanying the manuscript in *Food Quality and Preference*. [OSF](https://osf.io/)  is a free web application that provides a space for researchers to collaboratively store, manage, and share their research materials (e.g. data, code, protocols). Most work on OSF is organized around projects, which include a cloud-based storage bucket where files can be stored and organized into directories. Please navigate to the corresponding project, using your web browser. We can see that the project contains a data component named *Data Sets and Analysis Scripts*. If we click on the data component, we are provided with its own url identifyer which is: <https://osf.io/kst7p> This data component is housing the product acceptance scores for the cappuccino category within the data set named **Working dataset Cappuccino.csv** within the directory path **Data and analysis scripts/Main studies**. 

To load the data set we use functions provided by the *[osfr](https://cran.r-project.org/web/packages/osfr/index.html) package*.

We first assess the corresponding OSF data component from *R*. For this purpose we apply the function *osf_retrieve_node()*, which expects us to hand-in an url to an existing resource. We assign the results of the function to an object named *OSF_project_segmenting_consumers*. 

```{r}

OSF_project_segmenting_consumers <- osf_retrieve_node("https://osf.io/kst7p/")

```

The code chunk above opens a, so to say, table of content for the corresponding OSF data component.
Let’s list all of the files that have been uploaded to the path **Data and analysis scripts/Main studies**. This is done by the *osf_ls_files()* function:

```{r}

osf_ls_files(OSF_project_segmenting_consumers, path = "Data and analysis scripts/Main studies")

```

This returns an *osf_tbl* object, which is the *data.frame*-like class the *osfr* package uses to represent items retrieved from OSF. This one contains 8 rows; one for each of the files stored on the OSF data component. 
To download a local copy of the cappuccino data set (which is row 1 by the way), we use the *osf_download()* function. More specifically, we build a pipe of commands: First, we hand over our list of files stored in the OSF file path to a function *filter()*. This function helps us in selecting only the entry with the file named *Working dataset Cappuccino.csv*. The result of this step then goes as argument to the last command in the pipe, which is *osf_download()*.

```{r}

osf_ls_files(OSF_project_segmenting_consumers, path = "Data and analysis scripts/Main studies") %>%
  filter(name == "Working dataset Cappuccino.csv") %>%
  osf_download(conflicts = "overwrite")

```

As a result, the data set *Working dataset Cappuccino.csv* is stored to the current working directory of your *R*-project.
All we need to do, is to import it to our current *R* analysis session. For this purpose, we use *read.csv()* function.
We assign the data set to a new object **d**. In a last step, we convert the object to the [tibble] (https://tibble.tidyverse.org/) format, which is prominent among marketing researchers.

```{r}

d <- read.csv("Working dataset Cappuccino.csv")

d <- as_tibble(d)

```

Finally, we can give a brief overview over the imported data:

```{r}

print(d)

```

As we can see, the spreadsheet-like data set contains one row for each of the n=104 interviewed consumers. Furthermore, there are 13 variables as columns. The first variable houses the consumer ID, whereas the remaining columns comprise of the consumers' overall liking judgments ("OL") about the different product samples across the varying testing environments (scaled from 1 to 9). The abbreviations "Bar", "Lab", and "VR" thereby stand for the environments **Real Coffeehouse*"**, **Senory Lab**, and **Immersive Coffeehouse**. The abbreviations "Bar.1shot", "Bar.2shot", "Siz.1shot", and "Siz.2shot" mark the different product samples, namely cappuccinos made of different coffee brands (“Barista” and “Sizilianer Art”, according to the authors), and cappuccinos prepared with one or two shots of that coffee. 

------------------------------------------------------------------------

# Task 5.2.

> Apply a repeated measures ANOVA to the overall liking scores to evaluate if you are able to also extract a significant difference in product acceptance across test environments (a so-called level effect).

Here, we are asked to simply replicate the original analysis proposed by the authors. Thus, the easiest way to solve the task is to have a look at the analyses scripts provided on OSF. In task 5.1. we have seen that the OSF data component provides the *R* script **Sensory Acceptance Tests - Analysis Script.R**. We can review this script by downloading it.


```{r}

d$ID <- as_factor(d$ID)

names(d)

d_stacked <- pivot_longer(data = d, 
                          cols = OL.Bar.1shot...Lab:OL.Siz.2shot...Fil, 
                          names_to = "product_sample", 
                          values_to = "liking")


d_stacked <-  d_stacked %>% mutate(
  sample = case_when(
  str_detect(product_sample, "Bar.1shot") ~ 'Bar_1shot',
  str_detect(product_sample, "Siz.1shot") ~ 'Siz_1shot',
  str_detect(product_sample, "Siz.2shot") ~ 'Siz_2shot',
  str_detect(product_sample, "Bar.2shot") ~ 'Bar_2shot'
  ))

d_stacked <-  d_stacked %>% mutate(
  environment = case_when(
  str_detect(product_sample, "Lab") ~ 'Sensory_Lab',
  str_detect(product_sample, "VR") ~ 'Immersive_Coffeehouse',
  str_detect(product_sample, "Fil") ~ 'Real_Coffeehouse'
  ))

d_stacked$sample <- as_factor(d_stacked$sample)

d_stacked$environment <- as_factor(d_stacked$environment)

print(d_stacked)


```





```{r}



cappuccino_rANOVA <- anova_test(data = d_stacked,
                                dv = liking,
                                wid = ID,
                                within = c(sample, environment),
                                detailed = TRUE
                                )

print(cappuccino_rANOVA, 
      digits = 3)




```

------------------------------------------------------------------------

# Task 5.3.

> Use a different post-hoc test than the authors. Drawing on your chosen test, is the immersive environment still significantly different from the other two environments?

At page 4 of the Web Appendix the authors state: *"[...] running a series of repeated measures analysis of variance analyses (rANOVAs) combined with post hoc Bonferroni-corrected within-subjects t-tests."* Thus, in the article the authors applied the Bonferroni  correction  to account for multiple group comparisons. 


```{r}


post_hoc <- with(d_stacked, pairwise.t.test(x=liking, 
                                            g=environment, 
                                            p.adjust.method="holm", 
                                            paired=TRUE))
post_hoc



```


------------------------------------------------------------------------

# Task 5.4.

> Only focus on the real coffeehouse environment! If you choose a different post-hoc test as compared to the authors, do you find the same significant differences between products?

This task is very similar to the previous one. The difference is that we have to focus only at the real coffeehouse environment. Furthermore, we are investigating post-hoc tests for the sample factor instead of the environment factor.
 As an alternative to the authors' Bonferroni procedure, we below, again, draw on Holm's post-hoc test.
 
 
```{r}



```
 
 
 
 
 
 
 
------------------------------------------------------------------------

# List of References
